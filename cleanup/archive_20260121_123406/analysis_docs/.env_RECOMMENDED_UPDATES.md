# ‚úÖ Recommended .env Updates - Microsoft MCP Services

## Executive Summary

**YES** - You can and **SHOULD** use Microsoft's official MCP services! This resolves the invalid `MS_LEARN_MCP_URL` issue.

Based on the [official Microsoft MCP repository](https://github.com/microsoft/mcp), Microsoft provides **2 types** of MCP servers:
1. **Cloud-hosted (REMOTE)** - Production-ready, no installation required
2. **Local (self-hosted)** - Requires Node.js/Docker installation

## üéØ Recommended Configuration

### ‚ú® Use Microsoft Foundry MCP (Cloud-Hosted) **[RECOMMENDED]**

Microsoft now provides a **unified Foundry MCP server** that consolidates multiple tools into one endpoint:

```env
# Microsoft Foundry MCP Server (Cloud-hosted, no installation)
# Provides unified tools for: models, knowledge, evaluation, and more
# TYPE: REMOTE - https://mcp.ai.azure.com
# CATEGORY: CLOUD AND INFRASTRUCTURE
MS_LEARN_MCP_URL=https://mcp.ai.azure.com
```

**Benefits**:
- ‚úÖ **Production-ready** - Cloud-hosted by Microsoft
- ‚úÖ **No installation** - Works immediately
- ‚úÖ **Unified tools** - Multiple capabilities in one server
- ‚úÖ **Official Microsoft service** - Maintained and supported
- ‚úÖ **Zero dependencies** - No Node.js/Docker required

**Source**: [Microsoft MCP Repository - Foundry MCP](https://github.com/microsoft/mcp#-microsoft-foundry)

### üìö Alternative: Microsoft Learn MCP (Cloud-Hosted)

If you need **dedicated documentation search** (not the unified Foundry tools):

```env
# Microsoft Learn MCP Server (Cloud-hosted)
# Provides: Real-time access to official Microsoft documentation
# TYPE: REMOTE - https://learn.microsoft.com/api/mcp
# CATEGORY: PRODUCTIVITY
MS_LEARN_MCP_URL=https://learn.microsoft.com/api/mcp
```

**Tools Provided**:
- `microsoft_docs_search` - Semantic search across MS Learn
- `microsoft_docs_fetch` - Fetch full documentation pages
- `microsoft_code_sample_search` - Search code samples with language filters

**Source**: [Microsoft MCP Repository - Microsoft Learn](https://github.com/microsoft/mcp#-microsoft-learn)

---

## üîß Phase 2: IaC Generation MCP Servers

For Phase 2 (Bicep/Terraform generation), you have **2 options**:

### Option 1: Use Azure MCP (All-in-One) **[RECOMMENDED]**

```env
# Azure MCP Server - All Azure tools in one server
# Provides: Azure CLI, Resource Manager, Bicep support, and more
# TYPE: Local (requires installation)
# INSTALL: Install via VS Code extension
# Extension ID: ms-azuretools.vscode-azure-mcp-server
AZURE_MCP_URL=http://localhost:3100
```

**Installation**:
1. Install VS Code extension: `ms-azuretools.vscode-azure-mcp-server`
2. Or install via: `npx -y @azure/mcp-server`
3. Extension auto-starts the MCP server locally

**Benefits**:
- ‚úÖ **All Azure tools** - Comprehensive Azure capabilities
- ‚úÖ **Bicep support** - Built-in Bicep generation
- ‚úÖ **Official Microsoft** - Maintained by Azure Tools team
- ‚úÖ **VS Code integration** - Seamless with GitHub Copilot for Azure

**Replaces**: BICEP_MCP_URL, AZURE_DEVOPS_MCP_URL (Azure MCP includes these)

**Source**: [Microsoft MCP Repository - Azure](https://github.com/microsoft/mcp#-azure)

### Option 2: Use Individual MCP Servers (Specialized)

If you need **fine-grained control**, use individual MCP servers:

#### Bicep MCP Server (Local)
```env
# Bicep MCP Server - Bicep templates and best practices
# GitHub: https://github.com/microsoft/mcp/tree/main/servers/bicep
# INSTALL: npx -y @microsoft/mcp-server-bicep
BICEP_MCP_URL=http://localhost:3001
```

#### Terraform MCP Server (Local - HashiCorp Official)
```env
# Terraform MCP Server - HashiCorp Official
# Provides: Terraform Registry API, HCP Terraform, azurerm provider docs
# GitHub: https://github.com/hashicorp/terraform-mcp-server
# INSTALL: docker run -p 3002:3002 hashicorp/terraform-mcp-server
TERRAFORM_MCP_URL=http://localhost:3002
```

#### Azure DevOps MCP Server (Local)
```env
# Azure DevOps MCP Server - Pipeline templates and DevOps best practices
# GitHub: https://github.com/microsoft/azure-devops-mcp
# INSTALL: npx -y @azure-devops/mcp <org-name>
AZURE_DEVOPS_MCP_URL=http://localhost:3003
```

#### GitHub MCP Server (Cloud-Hosted)
```env
# GitHub MCP Server (Cloud-hosted)
# Provides: GitHub repositories, issues, PRs via API
# TYPE: REMOTE - https://api.githubcopilot.com/mcp
GITHUB_MCP_URL=https://api.githubcopilot.com/mcp
```

**Benefits**:
- ‚úÖ **Specialized tools** - Each MCP focused on specific domain
- ‚úÖ **Granular control** - Enable only what you need
- ‚úÖ **Latest features** - Direct access to specialized APIs

**Drawbacks**:
- ‚ö†Ô∏è **Multiple installations** - Each requires setup
- ‚ö†Ô∏è **Port management** - Need to manage multiple ports
- ‚ö†Ô∏è **More complexity** - More moving parts to maintain

---

## üìã Comparison: Foundry vs Individual MCPs

| Aspect | Microsoft Foundry MCP | Individual MCP Servers |
|--------|----------------------|----------------------|
| **Installation** | ‚úÖ Zero (cloud-hosted) | ‚ö†Ô∏è Requires Node.js/Docker |
| **Maintenance** | ‚úÖ Microsoft-managed | ‚ö†Ô∏è Self-managed |
| **Tools** | ‚úÖ Unified (models, knowledge, eval) | ‚ö†Ô∏è Specialized per MCP |
| **Availability** | ‚úÖ Always available | ‚ö†Ô∏è Must be running locally |
| **Azure Integration** | ‚úÖ Built-in | ‚ö†Ô∏è Requires Azure MCP |
| **Bicep Support** | ‚ö†Ô∏è Via Azure MCP (local) | ‚úÖ Dedicated Bicep MCP |
| **Terraform Support** | ‚ö†Ô∏è Via HashiCorp MCP (local) | ‚úÖ Dedicated Terraform MCP |
| **Best For** | Phase 1 + General AI | Phase 2 IaC Specialists |

---

## üéØ Recommended .env Configuration

### For Phase 1 (Design Extraction) - **READY NOW**

```env
# =============================================================================
# REQUIRED: Microsoft Foundry MCP Server (Cloud-hosted)
# =============================================================================
# Unified MCP server for models, knowledge, evaluation, and more
# TYPE: REMOTE - Cloud-hosted by Microsoft
# INSTALL: No installation required - works immediately
# TOOLS: Unified foundry tools (models, knowledge, evaluation)
MS_LEARN_MCP_URL=https://mcp.ai.azure.com

# =============================================================================
# PHASE 2: IaC Generation - CHOOSE YOUR APPROACH
# =============================================================================

# OPTION 1: Use Azure MCP (All-in-One) - RECOMMENDED
# Provides: Azure CLI, Resource Manager, Bicep, and more
# INSTALL: VS Code extension `ms-azuretools.vscode-azure-mcp-server`
# Or: npx -y @azure/mcp-server
AZURE_MCP_URL=http://localhost:3100

# OPTION 2: Use Individual Specialized MCPs (Advanced)
# BICEP_MCP_URL=http://localhost:3001
# TERRAFORM_MCP_URL=http://localhost:3002
# AZURE_DEVOPS_MCP_URL=http://localhost:3003
# GITHUB_MCP_URL=https://api.githubcopilot.com/mcp
```

### For Phase 2 (IaC Generation) - **ENHANCED SETUP**

**Scenario A: Zero-dependency approach (Current)**
```env
# Use Bing Grounding + Foundry MCP only
MS_LEARN_MCP_URL=https://mcp.ai.azure.com
BICEP_MCP_URL=
TERRAFORM_MCP_URL=
AZURE_DEVOPS_MCP_URL=
GITHUB_MCP_URL=
```

**Scenario B: Enhanced with Azure MCP (Recommended)**
```env
# Use Foundry MCP + Azure MCP for Bicep support
MS_LEARN_MCP_URL=https://mcp.ai.azure.com
AZURE_MCP_URL=http://localhost:3100  # Install via VS Code extension
BICEP_MCP_URL=
TERRAFORM_MCP_URL=http://localhost:3002  # Optional: HashiCorp official
AZURE_DEVOPS_MCP_URL=
GITHUB_MCP_URL=https://api.githubcopilot.com/mcp  # Cloud-hosted
```

**Scenario C: Full IaC specialist setup (Advanced)**
```env
# Use Foundry MCP + All specialized MCP servers
MS_LEARN_MCP_URL=https://mcp.ai.azure.com
AZURE_MCP_URL=http://localhost:3100
BICEP_MCP_URL=http://localhost:3101
TERRAFORM_MCP_URL=http://localhost:3102
AZURE_DEVOPS_MCP_URL=http://localhost:3103
GITHUB_MCP_URL=https://api.githubcopilot.com/mcp
```

---

## üîÑ Migration Steps

### Step 1: Update MS_LEARN_MCP_URL (Immediate)

**From** (INVALID):
```env
MS_LEARN_MCP_URL=https://learn.microsoft.com/api/mcp
```

**To** (VALID - Choose one):
```env
# Option A: Unified Foundry MCP (Recommended)
MS_LEARN_MCP_URL=https://mcp.ai.azure.com

# Option B: Dedicated Microsoft Learn MCP
MS_LEARN_MCP_URL=https://learn.microsoft.com/api/mcp
```

### Step 2: Update .env.example Comments

**Current** (.env.example):
```env
# MS Learn MCP Server - Cloud-hosted MCP server for Microsoft Learn documentation
# Provides 3 tools:
#   - microsoft_docs_search: Semantic search across Microsoft docs
#   - microsoft_docs_fetch: Fetch full documentation page content
#   - microsoft_code_sample_search: Search code samples with language filters
# URL: https://learn.microsoft.com/api/mcp (real endpoint, no auth required)
MS_LEARN_MCP_URL=https://learn.microsoft.com/api/mcp
```

**Recommended** (.env.example):
```env
# =============================================================================
# REQUIRED: Microsoft MCP Server
# =============================================================================
# CHOOSE ONE of the following options:
#
# OPTION 1: Microsoft Foundry MCP (RECOMMENDED)
# - Unified MCP server for models, knowledge, evaluation, and more
# - Cloud-hosted: https://mcp.ai.azure.com
# - No installation required
# - Best for: Phase 1 + general AI workflows
#
# OPTION 2: Microsoft Learn MCP (Dedicated Documentation)
# - Specialized for Microsoft Learn documentation search
# - Cloud-hosted: https://learn.microsoft.com/api/mcp
# - Tools: microsoft_docs_search, microsoft_docs_fetch, microsoft_code_sample_search
# - Best for: Dedicated documentation search workflows
#
# Documentation: https://github.com/microsoft/mcp
MS_LEARN_MCP_URL=https://mcp.ai.azure.com
```

### Step 3: Add Phase 2 Guidance

```env
# =============================================================================
# PHASE 2: IaC Generation MCP Servers (OPTIONAL)
# =============================================================================
# For enhanced Bicep/Terraform generation, choose your setup:
#
# RECOMMENDED: Azure MCP (All-in-One)
# - Install: VS Code extension `ms-azuretools.vscode-azure-mcp-server`
# - Or: npx -y @azure/mcp-server
# - Provides: Azure CLI, Resource Manager, Bicep, and more
# AZURE_MCP_URL=http://localhost:3100
AZURE_MCP_URL=

# OPTIONAL: Specialized MCP Servers (Advanced Users)
# Bicep: npx -y @microsoft/mcp-server-bicep
# Terraform: docker run -p 3002:3002 hashicorp/terraform-mcp-server
# Azure DevOps: npx -y @azure-devops/mcp <org-name>
# GitHub: Cloud-hosted at https://api.githubcopilot.com/mcp
BICEP_MCP_URL=
TERRAFORM_MCP_URL=
AZURE_DEVOPS_MCP_URL=
GITHUB_MCP_URL=

# =============================================================================
# NOTE: Agents automatically fallback to Bing Grounding + Foundry MCP
# if Phase 2 servers are unavailable. See MCP_SERVER_GUIDE.md for details.
# =============================================================================
```

---

## ü§î FAQ

### Q: Should I use Foundry MCP or Microsoft Learn MCP?

**A**: Use **Microsoft Foundry MCP** (`https://mcp.ai.azure.com`) for:
- ‚úÖ Unified tools (models, knowledge, evaluation)
- ‚úÖ Future-proof (Microsoft's unified MCP strategy)
- ‚úÖ Broader capabilities beyond just documentation

Use **Microsoft Learn MCP** (`https://learn.microsoft.com/api/mcp`) only if:
- ‚ö†Ô∏è You need dedicated documentation search tools ONLY
- ‚ö†Ô∏è You don't need other Foundry capabilities

### Q: Do I need Azure MCP for Bicep generation?

**A**: It depends on your requirements:

**Without Azure MCP** (Current zero-dependency approach):
- ‚úÖ Works with Bing Grounding + GPT-4o
- ‚úÖ Zero installation/maintenance
- ‚ö†Ô∏è Agent generates Bicep from research (no specialized Bicep API)
- ‚ö†Ô∏è Limited to publicly available best practices

**With Azure MCP** (Enhanced approach):
- ‚úÖ Specialized Bicep API access
- ‚úÖ Azure Verified Modules (AVM) direct integration
- ‚úÖ Real-time Azure Resource Manager schema
- ‚ö†Ô∏è Requires VS Code extension or npx installation
- ‚ö†Ô∏è Must be running locally

**Recommendation**: Start without Azure MCP (current approach), add later if needed.

### Q: Can I use both Foundry MCP and specialized MCPs together?

**A**: Yes! Recommended setup:
```env
MS_LEARN_MCP_URL=https://mcp.ai.azure.com  # General Foundry tools
AZURE_MCP_URL=http://localhost:3100        # Azure-specific tools
TERRAFORM_MCP_URL=http://localhost:3102    # Terraform-specific tools
GITHUB_MCP_URL=https://api.githubcopilot.com/mcp  # GitHub integration
```

Agents will choose the best MCP tool for each task.

### Q: What about the current Bing Grounding approach?

**A**: Keep it! Bing Grounding remains essential:
- ‚úÖ **Primary research tool** - Web search for latest docs/examples
- ‚úÖ **Always available** - No dependencies
- ‚úÖ **Complements MCPs** - MCP for structured APIs, Bing for web research

**Updated workflow**:
1. **Bing Grounding**: Search web for examples, patterns, best practices
2. **Foundry MCP**: Query structured Foundry tools (models, knowledge, eval)
3. **Azure MCP** (if installed): Access Azure APIs, Bicep schemas, AVM
4. **Terraform MCP** (if installed): Access Terraform Registry, HCP Terraform

---

## üìö References

1. **Microsoft MCP Repository**: https://github.com/microsoft/mcp
2. **Foundry MCP Documentation**: https://learn.microsoft.com/azure/ai-foundry/mcp/get-started
3. **Azure MCP Server**: https://github.com/microsoft/mcp/tree/main/servers/Azure.Mcp.Server
4. **Microsoft Learn MCP**: https://github.com/microsoftdocs/mcp
5. **Azure AI Foundry MCP Integration**: https://learn.microsoft.com/azure/ai-foundry/agents/how-to/tools/model-context-protocol

---

## ‚úÖ Action Items

### Immediate (Fix Critical Issue)
- [ ] Update `MS_LEARN_MCP_URL` from invalid endpoint to `https://mcp.ai.azure.com`
- [ ] Update .env.example with correct Microsoft MCP guidance
- [ ] Test agent functionality with new Foundry MCP endpoint

### Short-term (Phase 2 Enhancement)
- [ ] Evaluate if Azure MCP needed for Bicep generation
- [ ] Install Azure MCP via VS Code extension if needed
- [ ] Update agent instructions with Foundry MCP + Azure MCP tool usage
- [ ] Document MCP server installation steps in MCP_SERVER_GUIDE.md

### Long-term (Phase 2 Optimization)
- [ ] Consider Terraform MCP for Terraform-specific workflows
- [ ] Evaluate GitHub MCP for CI/CD pipeline generation
- [ ] Create validation script to check MCP server availability
- [ ] Update KNOWLEDGE_SOURCE_CLARIFICATION.md with MCP architecture

---

## üéâ Summary

**Critical Fix Required**:
```env
# BEFORE (INVALID):
MS_LEARN_MCP_URL=https://learn.microsoft.com/api/mcp  # Does not exist as documented

# AFTER (VALID):
MS_LEARN_MCP_URL=https://mcp.ai.azure.com  # Microsoft Foundry MCP (unified, cloud-hosted)
```

**Phase 2 Enhancement (Optional)**:
```env
# Add Azure MCP for Bicep support:
AZURE_MCP_URL=http://localhost:3100
# Install: VS Code extension `ms-azuretools.vscode-azure-mcp-server`
```

**Result**:
‚úÖ **Compliance**: All URLs valid and correct
‚úÖ **Zero-dependency**: Foundry MCP requires no installation
‚úÖ **Enhanced capabilities**: Access to unified Foundry tools
‚úÖ **Scalable**: Can add specialized MCPs as needed
